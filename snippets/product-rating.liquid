{% comment %}
  Product Rating Snippet
  Displays star rating for products
{% endcomment %}

<div class="flex items-center gap-1" data-product-rating="{{ product.id }}">
  {% if product.metafields.reviews.rating.value %}
    {% assign rating = product.metafields.reviews.rating.value %}
    {% assign rating_decimal = rating | round: 1 %}

    <!-- Generate star rating -->
    <div class="flex gap-0.5" aria-label="Rated {{ rating_decimal }} out of 5 stars">
      {% assign full_stars = rating | floor %}
      {% assign half_star = rating | modulo: 1 %}
      {% assign empty_stars = 5 | minus: full_stars | minus: half_star %}

      <!-- Full stars -->
      {% for i in (1..full_stars) %}
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-yellow-400">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
      {% endfor %}

      <!-- Half star -->
      {% if half_star >= 0.5 %}
        <svg width="16" height="16" viewBox="0 0 24 24" class="text-yellow-400">
          <defs>
            <linearGradient id="half-star-{{ product.id }}">
              <stop offset="50%" stop-color="currentColor"/>
              <stop offset="50%" stop-color="currentColor" stop-opacity="0.3"/>
            </linearGradient>
          </defs>
          <path fill="url(#half-star-{{ product.id }})" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
      {% endif %}

      <!-- Empty stars -->
      {% for i in (1..empty_stars) %}
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-300">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
      {% endfor %}
    </div>

    <span class="text-xs text-gray-500 ml-1">
      ({{ product.metafields.reviews.rating_count.value | default: 0 }})
    </span>

  {% else %}
    <!-- Default rating when no reviews exist -->
    <div class="flex gap-0.5" aria-label="Not yet rated">
      {% for i in (1..5) %}
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-300">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
      {% endfor %}
    </div>
    <span class="text-xs text-gray-500 ml-1">
      No reviews yet
    </span>
  {% endif %}
</div>