{% comment %}
  Structured Data (JSON-LD) for SEO
  Generates structured data based on page template
{% endcomment %}

{% comment %} Product structured data {% endcomment %}
{% if template contains 'product' %}
  {% assign current_variant = product.selected_or_first_available_variant %}
  {% assign product_images = product.images | where: 'attached_to_variant?', true | map: 'src' %}
  {% if product_images.size == 0 %}
    {% assign product_images = product.images | map: 'src' %}
  {% endif %}

  <script type="application/ld+json">
  {
    "@context": "https://schema.org/",
    "@type": "Product",
    "name": {{ product.title | json }},
    "url": {{ shop.url | append: product.url | json }},
    {% if product_images.size > 0 %}
      "image": [
        {% for image in product_images %}
          {{ image | prepend: "https:" | json }}{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ],
    {% endif %}
    "description": {{ product.description | strip_html | json }},
    "sku": {{ current_variant.sku | json }},
    "brand": {
      "@type": "Brand",
      "name": {{ shop.name | json }}
    },
    "offers": {
      "@type": "Offer",
      "url": {{ shop.url | append: product.url | json }},
      "priceCurrency": {{ cart.currency.iso_code | json }},
      "price": "{{ current_variant.price | divided_by: 100.00 }}",
      "priceValidUntil": "2099-12-31",
      "itemCondition": "https://schema.org/NewCondition",
      "availability": {% if current_variant.available %}"https://schema.org/InStock"{% else %}"https://schema.org/OutOfStock"{% endif %},
      "seller": {
        "@type": "Organization",
        "name": {{ shop.name | json }}
      }
    }
    {% if product.reviews_count > 0 %}
    ,"aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "{{ product.metafields.reviews.rating.value }}",
      "reviewCount": "{{ product.metafields.reviews.rating_count.value }}"
    }
    {% endif %}
  }
  </script>

{% comment %} Breadcrumb structured data {% endcomment %}
  {% elsif template contains 'product' or template contains 'collection' or template contains 'blog' or template contains 'article' %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": {{ shop.url | json }}
      }
      {% if template contains 'product' %}
        {% if collection %}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ collection.title | json }},
          "item": {{ shop.url | append: collection.url | json }}
        }
        {% endif %}
        ,{
          "@type": "ListItem",
          "position": {% if collection %}3{% else %}2{% endif %},
          "name": {{ product.title | json }},
          "item": {{ shop.url | append: product.url | json }}
        }
      {% elsif template contains 'collection' %}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ collection.title | json }},
          "item": {{ shop.url | append: collection.url | json }}
        }
      {% elsif template contains 'blog' %}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ blog.title | json }},
          "item": {{ shop.url | append: blog.url | json }}
        }
      {% elsif template contains 'article' %}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ blog.title | json }},
          "item": {{ shop.url | append: blog.url | json }}
        }
        ,{
          "@type": "ListItem",
          "position": 3,
          "name": {{ article.title | json }},
          "item": {{ shop.url | append: article.url | json }}
        }
      {% endif %}
    ]
  }
  </script>

{% comment %} Article structured data {% endcomment %}
{% elsif template contains 'article' %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": {{ shop.url | append: article.url | json }}
    },
    "headline": {{ article.title | json }},
    {% if article.image %}
    "image": [
      {{ article.image | img_url: 'master' | prepend: "https:" | json }}
    ],
    {% endif %}
    "datePublished": {{ article.published_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
    "dateModified": {{ article.updated_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
    "author": {
      "@type": "Person",
      "name": {{ article.author | json }}
    },
    "publisher": {
      "@type": "Organization",
      "name": {{ shop.name | json }},
      "logo": {
        "@type": "ImageObject",
        "url": {% if settings.logo_image %}{{ settings.logo_image | img_url: 'master' | prepend: "https:" | json }}{% else %}{{ shop.url | append: '/favicon.ico' | json }}{% endif %}
      }
    },
    "description": {{ article.excerpt | strip_html | json }}
  }
  </script>

{% comment %} Organization structured data {% endcomment %}
{% else %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": {{ shop.name | json }},
    "url": {{ shop.url | json }},
    {% if settings.logo_image %}
    "logo": {{ settings.logo_image | img_url: 'master' | prepend: "https:" | json }},
    {% endif %}
    "sameAs": [
      {% if settings.instagram_url != blank %}{{ settings.instagram_url | json }},{% endif %}
      {% if settings.twitter_url != blank %}{{ settings.twitter_url | json }},{% endif %}
      {% if settings.facebook_url != blank %}{{ settings.facebook_url | json }},{% endif %}
      {% if settings.linkedin_url != blank %}{{ settings.linkedin_url | json }}{% endif %}
    ],
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": {% if settings.contact_phone %}{{ settings.contact_phone | json }}{% else %}""{% endif %},
      "contactType": "customer service",
      "availableLanguage": ["English"]
    }
  }
  </script>

  <!-- Website structured data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": {{ shop.name | json }},
    "url": {{ shop.url | json }},
    "potentialAction": {
      "@type": "SearchAction",
      "target": "{{ shop.url }}/search?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
{% endif %}