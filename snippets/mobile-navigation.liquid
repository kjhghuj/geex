{% comment %}
  Mobile Navigation Menu Snippet
  Used in header section
{% endcomment %}

<!-- Mobile Navigation Menu -->
<nav class="mobile-menu fixed inset-y-0 left-0 z-50 w-full max-w-sm bg-white shadow-2xl transform -translate-x-full transition-transform duration-300 ease-in-out" data-mobile-menu>
  <div class="flex flex-col h-full">
    <!-- Mobile Menu Header -->
    <div class="flex items-center justify-between p-6 border-b border-gray-100 bg-gray-50/50">
      <div class="text-xl font-bold text-slate-900 flex items-center">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sky-500 mr-2">
          <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {{ shop.name }}
      </div>
      <button
        data-mobile-menu-toggle
        class="text-gray-400 hover:text-red-500 transition-colors p-2 rounded-full hover:bg-white shadow-sm"
        aria-label="Close menu"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu Content -->
    <div class="flex-1 overflow-y-auto">
      <!-- Main Navigation -->
      <div class="px-4 pt-2 pb-6 space-y-1">
        {% for link in linklists[menu].links %}
          {% assign active_class = '' %}
          {% if link.active or link.child_active %}
            {% assign active_class = 'bg-sky-50 text-sky-600' %}
          {% else %}
            {% assign active_class = 'text-gray-600 hover:bg-gray-50 hover:text-sky-500' %}
          {% endif %}

          {% if link.links.size > 0 %}
            <!-- Dropdown Menu -->
            <details class="group">
              <summary class="flex items-center justify-between w-full text-left px-4 py-3 text-base font-medium rounded-xl cursor-pointer {{ active_class }} transition-colors">
                <span>{{ link.title }}</span>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="group-open:rotate-180 transition-transform">
                  <path d="m6 9 6 6 6-6"/>
                </svg>
              </summary>
              <div class="mt-2 ml-4 space-y-1">
                {% for child_link in link.links %}
                  {% if child_link.active %}
                    {% assign child_active_class = 'bg-sky-50 text-sky-600' %}
                  {% else %}
                    {% assign child_active_class = 'text-gray-600 hover:bg-gray-50 hover:text-sky-500' %}
                  {% endif %}

                  <a
                    href="{{ child_link.url }}"
                    class="block px-4 py-2 text-sm font-medium rounded-lg {{ child_active_class }} transition-colors"
                  >
                    {{ child_link.title }}
                  </a>
                {% endfor %}
              </div>
            </details>
          {% else %}
            <!-- Regular Link -->
            <a
              href="{{ link.url }}"
              class="block w-full text-left px-4 py-3 text-base font-medium rounded-xl {{ active_class }} transition-colors"
            >
              {{ link.title }}
            </a>
          {% endif %}
        {% endfor %}

        <!-- Additional Mobile Links -->
        <a
          href="/search"
          class="block w-full text-left px-4 py-3 text-base font-medium rounded-xl text-gray-600 hover:bg-gray-50 hover:text-sky-500 transition-colors"
        >
          Search
        </a>

        {% if shop.customer_accounts_enabled %}
          {% if customer %}
            <a
              href="{{ routes.account_url }}"
              class="block w-full text-left px-4 py-3 text-base font-medium rounded-xl text-gray-600 hover:bg-gray-50 hover:text-sky-500 transition-colors"
            >
              My Account
            </a>
            <a
              href="{{ routes.account_logout_url }}"
              class="block w-full text-left px-4 py-3 text-base font-medium rounded-xl text-gray-600 hover:bg-gray-50 hover:text-sky-500 transition-colors"
            >
              Logout
            </a>
          {% else %}
            <a
              href="{{ routes.account_login_url }}"
              class="block w-full text-left px-4 py-3 text-base font-medium rounded-xl text-gray-600 hover:bg-gray-50 hover:text-sky-500 transition-colors"
            >
              Login
            </a>
            <a
              href="{{ routes.account_register_url }}"
              class="block w-full text-left px-4 py-3 text-base font-medium rounded-xl text-gray-600 hover:bg-gray-50 hover:text-sky-500 transition-colors"
            >
              Register
            </a>
          {% endif %}
        {% endif %}
      </div>

      <!-- Mobile Currency Selector (if enabled) -->
      {% if localization.available_countries.size > 1 %}
        <div class="border-t border-gray-100 p-4">
          <h3 class="text-sm font-medium text-gray-700 mb-3">Country/Region</h3>
          {% form 'localization', class: 'currency-selector' %}
            <select
              name="country_code"
              class="form-select"
              onchange="this.form.submit();"
            >
              {% for country in localization.available_countries %}
                <option
                  value="{{ country.iso_code }}"
                  {% if country.iso_code == localization.country.iso_code %}selected{% endif %}
                >
                  {{ country.name }} ({{ country.currency.iso_code }} {{ country.currency.symbol }})
                </option>
              {% endfor %}
            </select>
          {% endform %}
        </div>
      {% endif %}

      <!-- Mobile Language Selector (if enabled) -->
      {% if localization.available_languages.size > 1 %}
        <div class="border-t border-gray-100 p-4">
          <h3 class="text-sm font-medium text-gray-700 mb-3">Language</h3>
          {% form 'localization', class: 'language-selector' %}
            <select
              name="language_code"
              class="form-select"
              onchange="this.form.submit();"
            >
              {% for language in localization.available_languages %}
                <option
                  value="{{ language.iso_code }}"
                  {% if language.iso_code == localization.language.iso_code %}selected{% endif %}
                >
                  {{ language.endonym_name }}
                </option>
              {% endfor %}
            </select>
          {% endform %}
        </div>
      {% endif %}

      <!-- Mobile Contact Information -->
      <div class="border-t border-gray-100 p-4">
        <h3 class="text-sm font-medium text-gray-700 mb-3">Contact Us</h3>
        <div class="space-y-2 text-sm text-gray-600">
          {% if settings.contact_email != blank %}
            <a href="mailto:{{ settings.contact_email }}" class="hover:text-sky-500 transition-colors">
              {{ settings.contact_email }}
            </a>
          {% endif %}

          {% if settings.contact_phone != blank %}
            <a href="tel:{{ settings.contact_phone | replace: ' ', '' | replace: '(', '' | replace: ')', '' | replace: '-', '' }}" class="hover:text-sky-500 transition-colors">
              {{ settings.contact_phone }}
            </a>
          {% endif %}

          <div class="flex gap-4 pt-2">
            {% if settings.instagram_url != blank %}
              <a href="{{ settings.instagram_url }}" class="text-gray-400 hover:text-sky-500 transition-colors" aria-label="Instagram">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                  <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                  <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                </svg>
              </a>
            {% endif %}

            {% if settings.twitter_url != blank %}
              <a href="{{ settings.twitter_url }}" class="text-gray-400 hover:text-sky-500 transition-colors" aria-label="Twitter">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                </svg>
              </a>
            {% endif %}

            {% if settings.facebook_url != blank %}
              <a href="{{ settings.facebook_url }}" class="text-gray-400 hover:text-sky-500 transition-colors" aria-label="Facebook">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                </svg>
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Menu Footer -->
    <div class="border-t border-gray-100 p-4 bg-gray-50/50">
      <div class="text-center text-xs text-gray-500">
        &copy; {{ 'now' | date: '%Y' }} {{ shop.name }}. All rights reserved.
      </div>
    </div>
  </div>
</nav>

<!-- Mobile Menu Backdrop -->
<div class="mobile-menu-backdrop fixed inset-0 bg-black/50 backdrop-blur-sm z-40 hidden" data-mobile-menu-backdrop></div>

<style>
  .mobile-menu.open {
    transform: translateX(0);
  }

  .mobile-menu-backdrop.show {
    opacity: 1;
    visibility: visible;
  }

  @media (min-width: 768px) {
    .mobile-menu {
      display: none;
    }
    .mobile-menu-backdrop {
      display: none;
    }
  }

  /* Custom details dropdown styling */
  details summary::-webkit-details-marker {
    display: none;
  }

  details summary {
    list-style: none;
  }

  details summary::before {
    content: '';
    position: absolute;
    top: 50%;
    right: 1rem;
    transform: translateY(-50%);
    width: 8px;
    height: 8px;
    border-right: 2px solid currentColor;
    border-bottom: 2px solid currentColor;
    transform-origin: center;
    transition: transform 0.2s ease;
  }

  details[open] summary::before {
    transform: translateY(-50%) rotate(45deg);
  }
</style>