{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "label": "Main Menu",
      "default": "main-menu"
    }
  ]
}
{% endschema %}

<div x-data="{ mobileMenuOpen: false }" class="relative">
  <nav class="sticky top-[41px] z-50 bg-white/90 backdrop-blur-lg border-b border-gray-100 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-20">
        
        <a href="{{ routes.root_url }}" class="flex-shrink-0 flex items-center cursor-pointer group truncate">
          <div class="text-xl md:text-3xl font-display font-bold tracking-tight text-slate-900 flex items-center">
            <span class="text-sky-500 mr-2 bg-sky-50 p-1.5 rounded-lg group-hover:bg-sky-100 transition-colors shrink-0">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                <path d="M2 17L12 22L22 17" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                <path d="M2 12L12 17L22 12" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
              </svg>
            </span>
            <span class="truncate">{{ shop.name }}</span>
          </div>
        </a>

        <div class="hidden md:flex items-center bg-gray-50/50 p-1.5 rounded-full border border-gray-100">
          {% for link in linklists[section.settings.menu].links %}
            <a
              href="{{ link.url }}"
              class="px-5 py-2 text-sm font-medium rounded-full transition-all duration-300 
              {% if link.active %}bg-white text-sky-600 shadow-md shadow-gray-200{% else %}text-gray-500 hover:text-sky-500 hover:bg-white/50{% endif %}"
            >
              {{ link.title }}
            </a>
          {% endfor %}
        </div>

        <div class="hidden md:flex items-center gap-2">
          <a href="{{ routes.search_url }}" class="p-2.5 rounded-full transition-colors text-gray-400 hover:bg-gray-50 hover:text-sky-500">
             <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
          </a>
          
          <a href="{{ routes.cart_url }}" class="p-2.5 rounded-full transition-colors relative text-gray-400 hover:bg-gray-50 hover:text-sky-500 group">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
            
            <span class="js-cart-count absolute top-0 right-0 bg-sky-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold shadow-lg ring-2 ring-white transition-transform duration-200 {% if cart.item_count == 0 %}hidden scale-0{% endif %}">
                {{ cart.item_count }}
            </span>
          </a>

          {% if shop.customer_accounts_enabled %}
            <a href="{{ routes.account_url }}" class="p-2.5 rounded-full transition-colors text-gray-400 hover:bg-gray-50 hover:text-sky-500">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            </a>
          {% endif %}
        </div>

        <div class="md:hidden flex items-center gap-2">
           <a href="{{ routes.search_url }}" class="p-2 text-gray-500 hover:text-sky-500">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
           </a>

           {% if shop.customer_accounts_enabled %}
             <a href="{{ routes.account_url }}" class="p-2 text-gray-500 hover:text-sky-500">
               <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
             </a>
           {% endif %}

           <a href="{{ routes.cart_url }}" class="p-2 relative text-gray-500 hover:text-sky-500">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
             
             <span class="js-cart-count absolute -top-1 -right-1 bg-sky-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold {% if cart.item_count == 0 %}hidden scale-0{% endif %}">
                 {{ cart.item_count }}
             </span>
           </a>
           
           <button @click="mobileMenuOpen = !mobileMenuOpen" class="p-2 text-gray-500 hover:text-sky-500">
             <template x-if="!mobileMenuOpen">
               <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
             </template>
             <template x-if="mobileMenuOpen">
               <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
             </template>
           </button>
        </div>

      </div>
    </div>

    <div x-show="mobileMenuOpen" 
         x-transition
         x-cloak
         class="absolute top-full left-0 w-full bg-white border-t border-gray-100 shadow-2xl z-50 md:hidden origin-top"
         style="max-height: calc(100vh - 80px); overflow-y: auto;">
        <div class="px-4 pt-4 pb-8 space-y-2">
            {% for link in linklists[section.settings.menu].links %}
              <a href="{{ link.url }}" class="block w-full text-left px-4 py-3 text-lg font-medium rounded-xl text-slate-600 hover:bg-sky-50 hover:text-sky-600 transition-colors">
                {{ link.title }}
              </a>
            {% endfor %}
            </div>
    </div>
  </nav>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 监听来自 main-product.liquid 的 cart:refresh 事件
    document.documentElement.addEventListener('cart:refresh', function() {
        fetch('/cart.js')
            .then(response => response.json())
            .then(cart => {
                // 更新所有购物车图标（桌面端和移动端）
                const badges = document.querySelectorAll('.js-cart-count');
                
                badges.forEach(badge => {
                    badge.innerText = cart.item_count;
                    
                    if (cart.item_count > 0) {
                        badge.classList.remove('hidden', 'scale-0');
                        // 加一点小动画让用户注意到变化
                        badge.classList.add('scale-125');
                        setTimeout(() => badge.classList.remove('scale-125'), 200);
                    } else {
                        badge.classList.add('hidden', 'scale-0');
                    }
                });
            })
            .catch(e => console.error('Error fetching cart:', e));
    });
});
</script>